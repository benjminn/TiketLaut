<UserControl x:Class="TiketLaut.Views.AdminTiketPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="clr-namespace:TiketLaut.Views">

    <UserControl.Resources>

        <local:StatusToColorConverter x:Key="StatusToColor" />

        <!-- Card Shadow -->
        <DropShadowEffect x:Key="CardShadow" 
                 BlurRadius="15" 
                 ShadowDepth="3" 
                 Opacity="0.15" 
                 Color="#000000"/>

        <!-- Same styles as AdminDashboard -->
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
            <Setter Property="Effect" Value="{StaticResource CardShadow}"/>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="#00658D"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                        CornerRadius="8"
                        Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#267DAE"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="#DC3545"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#C82333"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="InfoButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="#6C757D"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#5A6268"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="TextBoxStyle" TargetType="TextBox">
        </Style>
        <Style x:Key="ComboBoxStyle" TargetType="ComboBox">
        </Style>

        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#00658D"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="BorderThickness" Value="0,0,1,0"/>
            <Setter Property="BorderBrush" Value="#267DAE"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>

        <Style TargetType="DataGridCell">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#E8F4F8"/>
                    <Setter Property="Foreground" Value="#011C4B"/>
                </Trigger>
            </Style.Triggers>
        </Style>

    </UserControl.Resources>

    <Grid Margin="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Filter Section -->
        <Border Grid.Row="1"
                Style="{StaticResource CardStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="120"/>
                </Grid.ColumnDefinitions>

                <!-- Search Kode Tiket -->
                <Grid Grid.Column="0"
                      Margin="0,0,15,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0"
                               Text="Cari Kode Tiket"
                               FontWeight="SemiBold"
                               Foreground="#64748B"
                               Margin="0,0,0,8"/>
                    <Grid Grid.Row="1">
                        <TextBox x:Name="txtSearchKodeTiket"
                                 Style="{StaticResource TextBoxStyle}"
                                 TextChanged="TxtSearchKodeTiket_TextChanged"/>
                        <TextBlock Text="TKT-202511..."
                                   Foreground="#999"
                                   FontStyle="Italic"
                                   IsHitTestVisible="False"
                                   Margin="10,0,0,0"
                                   VerticalAlignment="Top">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Text, ElementName=txtSearchKodeTiket}"
                                                     Value="">
                                            <Setter Property="Visibility"
                                                    Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                    <Setter Property="Visibility"
                                            Value="Hidden"/>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>
                </Grid>

                <!-- Filter Jadwal -->
                <Grid Grid.Column="1"
                      Margin="0,0,15,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0"
                               Text="Jadwal"
                               FontWeight="SemiBold"
                               Foreground="#64748B"
                               Margin="0,0,0,8"/>
                    <ComboBox Grid.Row="1"
                          x:Name="cmbJadwal"
                          Style="{StaticResource ComboBoxStyle}"
                          DisplayMemberPath="Text" 
                          SelectedValuePath="Id"
                          SelectionChanged="CmbJadwal_SelectionChanged"/>
                </Grid>


                <!-- Filter Status -->
                <Grid Grid.Column="2"
                      Margin="0,0,15,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0"
                               Text="Status"
                               FontWeight="SemiBold"
                               Foreground="#64748B"
                               Margin="0,0,0,8"/>
                    <ComboBox Grid.Row="1"
                              x:Name="cmbStatus"
                              Style="{StaticResource ComboBoxStyle}"
                              SelectionChanged="CmbStatus_SelectionChanged">
                        <ComboBoxItem>Semua Status</ComboBoxItem>
                        <ComboBoxItem>Menunggu Pembayaran</ComboBoxItem>
                        <ComboBoxItem>Aktif</ComboBoxItem>
                        <ComboBoxItem>Gagal</ComboBoxItem>
                    </ComboBox>
                </Grid>

                <!-- Filter Tanggal -->
                <Grid Grid.Column="3"
                    Margin="0,0,15,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                   Text="Tanggal Pemesanan"
                   FontWeight="SemiBold"
                   Foreground="#64748B"
                   Margin="0,0,0,8"/>   

                    <DatePicker Grid.Row="1"
                        x:Name="dpTanggal"
                        SelectedDateChanged="DpTanggal_SelectedDateChanged"
                        Background="White"
                        BorderBrush="#E2E8F0"
                        BorderThickness="1"                
                        Padding="0,0" 
                        FontSize="13"/>
                </Grid>

                <!-- Reset Button -->
                <StackPanel Grid.Column="5"
                            VerticalAlignment="Bottom">
                    <Button Content="Reset Filter"
                            Click="BtnResetFilter_Click"
                            Padding="12,10"
                            FontSize="12">
                        <Button.Style>
                            <Style TargetType="Button"
                                   BasedOn="{StaticResource PrimaryButton}">
                                <Setter Property="Background"
                                        Value="#6C757D"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver"
                                             Value="True">
                                        <Setter Property="Background"
                                                Value="#5A6268"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Data Grid Section -->
        <Border Grid.Row="2"
                Style="{StaticResource CardStyle}"
                Margin="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <DataGrid Grid.Row="1"
                          x:Name="dgTiket"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="Column"
                          RowHeight="50"
                          ColumnHeaderHeight="45"
                          AlternatingRowBackground="#F8F9FA"
                          Background="White"
                          BorderBrush="#DEE2E6"
                          BorderThickness="1"
                          FontSize="13"
                          MouseDoubleClick="DgTiket_MouseDoubleClick">

                    <DataGrid.Columns>

                        <DataGridTextColumn Header="Kode Tiket" Binding="{Binding Tiket.kode_tiket}" Width="*" MinWidth="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Left"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Padding" Value="12,0,0,0"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="Pengguna" Binding="{Binding Tiket.Pengguna.nama}" Width="*" MinWidth="100">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Left"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Padding" Value="12,0,0,0"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTemplateColumn Header="Jadwal" Width="*" MinWidth="120" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock TextTrimming="CharacterEllipsis" VerticalAlignment="Center" Padding="5,0" HorizontalAlignment="Left">
                                        <Run Text="{Binding Tiket.Jadwal.pelabuhan_asal.nama_pelabuhan}" FontWeight="SemiBold" />
                                        <Run Text=" → " />
                                        <Run Text="{Binding Tiket.Jadwal.pelabuhan_tujuan.nama_pelabuhan}" FontWeight="SemiBold" />
                                        <LineBreak />
                                        <Run Text="{Binding Tiket.Jadwal.waktu_berangkat, StringFormat='dd MMM yyyy HH:mm'}" 
                                             FontSize="11" 
                                             Foreground="#64748B" />
                                    </TextBlock>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTextColumn Header="Total Harga" Width="*" MinWidth="100" IsReadOnly="True">
                            <DataGridTextColumn.Binding>
                                <Binding Path="Tiket.total_harga" StringFormat="Rp {0:N0}"/>
                            </DataGridTextColumn.Binding>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="Tanggal Pemesanan" Width="*" MinWidth="150" IsReadOnly="True">
                            <DataGridTextColumn.Binding>
                                <Binding Path="Tiket.tanggal_pemesanan" StringFormat="dd MMMM yyyy HH:mm"/>
                            </DataGridTextColumn.Binding>
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="Kendaraan" Binding="{Binding Tiket.jenis_kendaraan_enum}" Width="*" MinWidth="140" IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="Penumpang" Binding="{Binding Tiket.jumlah_penumpang}" Width="*" MinWidth="50" IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTemplateColumn Header="Status" Width="*" MinWidth="130" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border x:Name="borderStatus" 
                                            CornerRadius="12"
                                            Padding="10,6"
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Background="{Binding Tiket.status_tiket, Converter={StaticResource StatusToColor}}">
                                        <TextBlock Text="{Binding Tiket.status_tiket}"
                                                   Foreground="White"
                                                   FontWeight="SemiBold"
                                                   FontSize="12"/>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTemplateColumn Header="Aksi" Width="*" MinWidth="200" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal"
                                                Margin="5"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center">
                                        <Button Content="Detail"
                                                Style="{StaticResource InfoButton}"
                                                Click="BtnDetail_Click"
                                                Margin="0,0,5,0"
                                                Padding="10,8"
                                                FontSize="12"/>
                                        <Button Content="Edit"
                                                Style="{StaticResource PrimaryButton}"
                                                Click="BtnEdit_Click"
                                                Margin="0,0,5,0"
                                                Padding="10,8"
                                                FontSize="12"/>
                                        <Button Content="Hapus"
                                                Style="{StaticResource DangerButton}"
                                                Click="BtnDelete_Click"
                                                Padding="10,8"
                                                FontSize="12"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                    </DataGrid.Columns>

                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="White"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#F8F9FA"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>

                </DataGrid>

                <TextBlock x:Name="txtNoData"
                           Grid.Row="1"
                           Text="Tidak ada tiket"
                           FontSize="18"
                           FontWeight="SemiBold"
                           Foreground="#6C757D"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="Collapsed" />
            </Grid>
        </Border>

        <!-- Pagination Controls -->
        <Border Grid.Row="3"
                Style="{StaticResource CardStyle}"
                Margin="0,0,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Pagination Info -->
                <TextBlock Grid.Column="0"
                           x:Name="txtPaginationInfo"
                           Text="Page 1 - Menampilkan 30 dari 30 tiket"
                           FontSize="14"
                           FontWeight="Medium"
                           Foreground="#00658D"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Left"/>

                <!-- Navigation Buttons -->
                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal"
                            HorizontalAlignment="Center">
                    <Button x:Name="btnPrevPage"
                            Content="◀ Previous"
                            Style="{StaticResource PrimaryButton}"
                            Click="BtnPrevPage_Click"
                            Margin="0,0,10,0"
                            Padding="12,8"
                            FontSize="13"
                            IsEnabled="False"/>
                    
                    <TextBlock x:Name="txtPageNumber"
                               Text="1"
                               FontSize="16"
                               FontWeight="Bold"
                               Foreground="#00658D"
                               VerticalAlignment="Center"
                               Margin="15,0"
                               MinWidth="30"
                               TextAlignment="Center"/>
                    
                    <Button x:Name="btnNextPage"
                            Content="Next ▶"
                            Style="{StaticResource PrimaryButton}"
                            Click="BtnNextPage_Click"
                            Margin="10,0,0,0"
                            Padding="12,8"
                            FontSize="13"/>
                </StackPanel>

                <!-- Total Records Info -->
                <TextBlock Grid.Column="2"
                           x:Name="txtTotalRecords"
                           Text="Total: 30 tiket"
                           FontSize="14"
                           FontWeight="Medium"
                           Foreground="#6C757D"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
